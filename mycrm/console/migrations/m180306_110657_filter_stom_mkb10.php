<?php

use core\models\medCard\MedCardDiagnosis;
use core\models\ServiceCategory;
use yii\db\Migration;

/**
 * Class m180306_110657_filter_stom_mkb10
 */
class m180306_110657_filter_stom_mkb10 extends Migration
{
    private $stom_category_id = 124;

    /**
     * @inheritdoc
     */
    public function safeUp()
    {
        $this->createTable('{{%med_card_diagnosis_service_category_map}}', [
            'med_card_diagnosis_id' => $this->integer()->unsigned()->notNull(),
            'service_category_id' => $this->integer()->unsigned()->notNull()
        ]);

        $this->createIndex(
            'uq_med_card_diagnosis_service_category_map_med_card_diagnosis_id_service_category_id',
            '{{%med_card_diagnosis_service_category_map}}',
            ['med_card_diagnosis_id', 'service_category_id'],
            true
        );

        $this->addForeignKey(
            'fk_med_card_diagnosis_service_category_map_service_category',
            '{{%med_card_diagnosis_service_category_map}}',
            'service_category_id',
            ServiceCategory::tableName(),
            'id'
        );
        $this->addForeignKey(
            'fk_med_card_diagnosis_service_category_map_med_card_diagnosis',
            '{{%med_card_diagnosis_service_category_map}}',
            'med_card_diagnosis_id',
            MedCardDiagnosis::tableName(),
            'id'
        );

        $i=0;
        foreach ($this->mkb10 as $diagnose_code) {
            /* @var MedCardDiagnosis $diagnose */
            $diagnose = MedCardDiagnosis::find()->where(['code' => $diagnose_code])->one();

            if (empty($diagnose)) {
                $i++;
                echo "{$i} $diagnose_code \n";
                continue;
            }

            echo "{$diagnose->code} ||| ";
            $this->insert('{{%med_card_diagnosis_service_category_map}}', [
                'med_card_diagnosis_id' => $diagnose->id,
                'service_category_id' => $this->stom_category_id
            ]);
        }
    }

    /**
     * @inheritdoc
     */
    public function safeDown()
    {
        $this->dropTable('{{%med_card_diagnosis_service_category_map}}');
    }

    private $mkb10
        = [
//            "B00.10",
//            "B00.11",
//            "B00.2Х",
//            "B02.20",
//            "B02.21",
//            "B02.8Х",
            "B07",
//            "B07.Х0",
//            "B07.Х1",
//            "B08.3Х",
//            "B08.4Х",
            "B08.5",
            "B20",
//            "B20.0Х",
//            "B20.1Х",
//            "B20.2Х",
//            "B20.3Х",
//            "B20.4Х",
//            "B37.00",
//            "B37.01",
//            "B37.02",
//            "B37.03",
//            "B37.04",
//            "B37.05",
//            "B37.06",
//            "B37.08",
//            "B37.09",
//            "B75.VХ",
            "C00",
            "C43.0",
            "C44.0",
//            "C00.0Х",
//            "C00.1Х",
            "C01",
            "C02",
            "C03",
            "C04",
            "C05",
            "C06.0",
            "C06.1",
            "C06.2",
            "C07",
            "C08",
            "C31",
            "C41.1",
//            "C41.10",
//            "C41.11",
            "D00",
//            "D00.00",
//            "D00.01",
//            "D00.02",
//            "D00.03",
//            "D00.04",
            "D10.0",
            "D10.1",
            "D10.2",
//            "D10.30",
//            "D10.31",
//            "D10.32",
//            "D10.33",
//            "D10.34",
//            "D10.35",
//            "D10.37",
//            "D10.38",
            "D11.0",
//            "D11.70",
//            "D11.71",
            "D11.9",
            "D16.4",
            "D16.5",
            "D17.0",
//            "D18.0Х",
//            "D18.1Х",
            "D22",
//            "E14.ХХ",
//            "G40.VX",
            "G50",
            "G50.0",
            "G50.1",
            "G50.8",
            "G50.9",
            "G51",
//            "G52.1Х",
            "G52",
            "I78.0",
            "I86.0",
            "I88",
            "J01",
            "J01.0",
            "J01.1",
            "J03",
            "J10",
            "J32",
            "J32.0",
            "J35.0",
            "J36",
            "K00",
            "K00.0",
            "K00.00",
            "K00.01",
            "K00.09",
            "K00.1",
            "K00.10",
            "K00.11",
            "K00.12",
            "K00.19",
            "K00.2",
            "K00.20",
            "K00.21",
            "K00.22",
            "K00.23",
            "K00.24",
            "K00.25",
            "K00.26",
            "K00.27",
            "K00.28",
            "K00.29",
            "K00.3",
            "K00.30",
            "K00.31",
            "K00.39",
            "K00.4",
            "K00.40",
            "K00.41",
            "K00.42",
            "K00.43",
            "K00.44",
            "K00.45",
            "K00.46",
            "K00.48",
            "K00.49",
            "K00.5",
            "K00.50",
            "K00.51",
            "K00.52",
            "K00.58",
            "K00.59",
            "K00.6",
            "K00.60",
            "K00.61",
            "K00.62",
            "K00.63",
            "K00.64",
            "K00.65",
            "K00.68",
            "K00.69",
            "K00.7",
            "K00.8",
            "K00.80",
            "K00.81",
            "K00.82",
            "K00.83",
            "K00.88",
            "K00.9",
            "K01",
            "K01.0",
            "K01.1",
            "K01.10",
            "K01.11",
            "K01.12",
            "K01.13",
            "K01.14",
            "K01.15",
            "K01.17",
            "K01.18",
            "K01.19",
            "K02",
            "K02.0",
            "K02.1",
            "K02.2",
            "K02.3",
            "K02.4",
            "K02.8",
            "K02.9",
            "K03",
            "F45.8",
            "K03.0",
            "K03.00",
            "K03.01",
            "K03.08",
            "K03.09",
            "K03.1",
            "K03.10",
            "K03.11",
            "K03.12",
            "K03.13",
            "K03.18",
            "K03.19",
            "K03.2",
            "K03.20",
            "K03.21",
            "K03.22",
            "K03.23",
            "K03.24",
            "K03.28",
            "K03.29",
            "K03.3",
            "K03.30",
            "K03.31",
            "K03.39",
            "K03.4",
            "K03.5",
            "K03.6",
            "K03.60",
            "K03.61",
            "K03.63",
            "K03.64",
            "K03.65",
            "K03.66",
            "K03.68",
            "K03.69",
            "K03.7",
            "K03.70",
            "K03.71",
            "K03.72",
            "K03.78",
            "K03.79",
            "K03.8",
            "K03.80",
            "K03.81",
            "K03.88",
            "K03.9",
            "K04",
            "K04.0",
            "K04.00",
            "K04.01",
            "K04.02",
            "K04.03",
            "K04.04",
            "K04.05",
            "K04.08",
            "K04.09",
            "K04.1",
            "K04.2",
            "K04.3",
            "K04.4",
            "K04.5",
            "K04.6",
            "K04.60",
            "K04.61",
            "K04.62",
            "K04.63",
            "K04.69",
            "K04.7",
            "K04.8",
            "K04.80",
            "K04.81",
            "K04.82",
            "K04.89",
            "K04.9",
            "K05",
            "K05.0",
            "K05.22",
//            "A69.10",
            "K05.00",
            "K05.08",
            "K05.09",
            "K05.1",
            "K05.10",
            "K05.11",
            "K05.12",
            "K05.13",
            "K05.18",
            "K05.19",
            "K05.2",
            "K05.20",
            "K05.21",
            "K05.28",
            "K05.29",
            "K05.3",
            "K05.30",
            "K05.31",
            "K05.32",
            "K05.33",
//            "K05.38",
//            "K05.39",
            "K05.4",
            "K05.5",
            "K06",
            "K06.0",
            "K06.00",
            "K06.01",
            "K06.09",
            "K06.1",
            "K06.10",
            "K06.18",
            "K06.19",
            "K06.2",
            "K06.20",
            "K06.21",
            "K06.22",
            "K06.23",
            "K06.28",
            "K06.29",
            "K06.8",
            "K06.80",
            "K06.81",
            "K06.82",
            "K06.83",
            "K06.84",
            "K06.88",
            "K06.9",
            "K07",
            "K07.0",
            "E22.0",
            "K07.00",
            "K07.01",
            "K07.02",
            "K07.03",
            "K07.04",
            "K07.08",
            "K07.09",
            "K07.1",
            "K07.10",
            "K07.11",
            "K07.12",
            "K07.13",
            "K07.14",
            "K07.18",
            "K07.19",
            "K07.2",
            "K07.20",
            "K07.21",
            "K07.22",
            "K07.23",
            "K07.24",
            "K07.25",
            "K07.26",
            "K07.27",
            "K07.28",
            "K07.29",
            "K07.3",
            "K07.30",
            "K07.31",
            "K07.32",
            "K07.33",
            "K07.34",
            "K07.35",
            "K07.38",
            "K07.39",
            "K07.4",
            "K07.5",
            "K07.50",
            "K07.51",
            "K07.54",
            "K07.55",
            "K07.58",
            "K07.59",
            "K07.6",
            "K07.60",
            "K07.61",
            "K07.62",
            "K07.63",
            "K07.64",
            "K07.65",
            "K07.68",
            "K07.69",
            "K08",
            "K08.1",
            "K08.2",
            "K08.3",
            "K08.8",
//            "K08.80",
//            "K08.81",
//            "K08.82",
//            "K08.88",
            "K08.9",
            "K09",
            "K09.00",
            "K09.01",
            "K09.02",
            "K09.03",
            "K09.04",
            "K09.08",
            "K09.09",
            "K09.1",
            "K09.10",
            "K09.11",
            "K09.12",
            "K09.13",
            "K09.18",
            "K09.19",
            "K09.2",
            "K09.20",
            "K09.21",
            "K09.22",
            "K09.28",
            "K09.29",
            "K10",
            "K10.0",
            "K10.00",
            "K10.01",
            "K10.02",
            "K10.08",
            "K10.09",
            "K10.1",
            "K10.2",
            "K10.20",
            "K10.3",
            "K10.21",
            "K10.22",
            "K10.23",
            "K10.24",
            "K10.25",
            "K10.26",
            "K10.28",
            "K10.29",
            "K10.8",
            "K10.80",
            "K10.81",
            "K10.82",
            "K10.83",
            "K10.88",
            "K11",
            "K11.0",
            "K11.1",
            "K11.2",
            "K11.3",
            "K11.4",
            "K11.5",
            "K11.6",
            "K11.60",
            "K11.61",
            "K11.69",
            "K11.7",
            "K11.70",
            "M35.0",
            "K11.71",
            "K11.72",
            "K11.78",
            "K11.79",
            "K11.8",
            "K11.80",
            "K11.81",
            "K11.82",
            "K11.83",
            "K11.84",
            "K11.85",
            "K12",
            "A69.0",
            "L23.0",
//            "B37.0",
            "B34.1",
            "T36",
            "T50",
            "B08.4",
            "K12.0",
            "K12.00",
            "K12.01",
            "K12.02",
            "K12.03",
            "K12.04",
            "K12.08",
            "K12.09",
            "K12.1",
            "K12.10",
            "K12.11",
            "K12.12",
            "K12.13",
            "K12.14",
            "K12.18",
            "K12.19",
            "K12.2",
            "K13",
            "K13.0",
//            "L56.8Х",
            "K13.00",
            "E53.0",
            "K13.01",
            "K13.02",
            "K13.03",
            "K13.04",
            "K13.08",
            "K13.09",
            "K13.1",
            "K13.2",
//            "B07.Х2",
            "K13.3",
            "K13.20",
//            "K12.21",
            "K13.24",
            "K13.22",
            "K13.23",
            "K13.28",
            "K13.29",
            "K13.4",
            "K13.40",
            "K13.41",
            "D76.0",
            "K13.42",
            "K13.5",
            "K13.6",
            "K13.7",
            "K13.70",
            "K13.71",
            "K13.72",
            "K13.73",
            "K13.78",
            "K13.79",
            "K14",
            "K14.0",
//            "K14.42",
            "K14.00",
            "K14.01",
            "K14.08",
            "K14.09",
            "K14.1",
            "K14.2",
            "K14.3",
            "K14.30",
            "K14.31",
            "K14.32",
            "K14.38",
            "K14.39",
            "K14.4",
            "K14.40",
            "K14.41",
            "K14.48",
            "K14.49",
            "K14.5",
            "K14.6",
            "K14.60",
            "K14.61",
            "K14.68",
            "K14.8",
            "K14.80",
            "K14.81",
            "K14.82",
            "K14.88",
            "K14.9",
            "K50",
            "L02",
            "L03",
//            "K12.2Х",
            "L03.2",
            "L04",
            "I88.1",
            "L08",
            "L08.0",
            "L10",
//            "L10.0Х",
            "L10.1",
            "L10.2",
            "L10.5",
            "L12",
            "L13",
            "L23",
            "L40",
            "L40.0",
            "L42",
            "L43",
            "L43.1",
            "L43.8",
//            "L43.80",
//            "L43.81",
//            "L43.82",
//            "L43.83",
//            "L43.88",
//            "L43.89",
            "L51",
            "L51.0",
            "L51.1",
            "L51.9",
            "L71",
            "L80",
            "L81",
            "L82",
            "L83",
            "L90",
            "L91.0",
            "L92.2",
            "L92.3",
            "L93",
            "L93.0",
            "L94.0",
            "L98.0",
            "M00",
            "M02",
//            "M00.3Х",
            "M05",
            "M08",
//            "M12.5Х",
            "M13",
            "M13.9",
            "M15",
//            "M19.0Х",
//            "M35.0Х",
            "M79.1",
//            "M79.2Х",
            "M79.5",
//            "M80.VХ",
//            "M84.0Х",
//            "M84.1Х",
//            "M84.2Х",
            "M88",
            "O26.8",
//            "O26.80",
//            "O26.81",
//            "O26.88",
//            "O26.89",
            "Q85.0",
            "Q35",
            "Q37",
            "Q75",
            "Q18.4",
            "Q18.5",
            "Q18.6",
            "Q18.7",
//            "Q21.3Х",
//            "Q38.31",
//            "Q38.32",
//            "Q38.33",
//            "Q38.34",
//            "Q38.35",
//            "Q38.36",
//            "Q38.40",
//            "Q38.42",
//            "Q38.51",
            "Q90",
            "R06.5",
            "R19.6",
            "R20.0",
            "R20.1",
            "R20.2",
            "R20.3",
//            "R23.0Х",
            "R23.2",
            "R23.3",
            "R43",
            "R43.2",
            "R47.0",
            "S00",
            "S00.0",
            "S00.1",
            "S00.2",
            "S00.3",
            "S00.4",
//            "S00.50",
//            "S00.51",
//            "S00.52",
//            "S00.59",
            "S00.7",
            "S01",
            "S01.0",
            "S01.1",
            "S01.2",
            "S01.3",
            "S01.4",
            "S01.5",
            "S02.0",
            "S02.1",
            "S02.2",
            "S02.3",
//            "S02.40",
//            "S02.41",
//            "S02.42",
//            "S02.47",
            "S02.5",
//            "S02.50",
//            "S02.51",
//            "S02.52",
//            "S02.53",
//            "S02.54",
//            "S02.57",
//            "S02.59",
            "S02.6",
//            "S02.60",
//            "S02.61",
//            "S02.62",
//            "S02.63",
//            "S02.64",
//            "S02.65",
//            "S02.66",
//            "S02.67",
//            "S02.69",
            "S02.7",
            "S02.9",
            "S03",
            "S03.0",
            "S03.1",
            "S03.2",
//            "S03.20",
//            "S03.21",
//            "S03.22",
            "S03.4",
            "S04",
            "S04.3",
            "S04.5",
            "S04.8",
            "S04.9",
            "S07.0",
            "S09.1",
            "S10",
            "S11",
            "T18.0",
            "T20",
            "T28.0",
            "T28.5",
            "T33",
            "T41",
            "T49.7",
            "T51",
            "T57.0",
            "T78.3",
            "T78.4",
            "T88",
            "T81.0",
            "T81.2",
            "T81.3",
            "T81.4",
            "T81.8",
            "T84.7",
            "Y60",
            "Y60.0",
            "Y61",
            "Y61.0",
        ];
}
